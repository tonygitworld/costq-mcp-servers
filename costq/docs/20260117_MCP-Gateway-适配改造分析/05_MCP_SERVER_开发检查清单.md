# MCP Server å¼€å‘æ£€æŸ¥æ¸…å•

> åœ¨å¼€å‘å’Œéƒ¨ç½² MCP Server å‰ï¼Œè¯·é€é¡¹æ£€æŸ¥æ­¤æ¸…å•

**é¡¹ç›®åç§°**: _______________
**å¼€å‘äººå‘˜**: _______________
**æ£€æŸ¥æ—¥æœŸ**: _______________

---

## ğŸ“‹ é˜¶æ®µ 1: è®¾è®¡ä¸è§„åˆ’

### 1.1 å‘½åè§„èŒƒ

- [ ] æœåŠ¡å™¨åç§°ç¬¦åˆæ ¼å¼: `awslabs.<project>-<service>-mcp-server`
- [ ] åŒ…åç§°ä½¿ç”¨ snake_case: `<project>_<service>_mcp_server`
- [ ] å·¥å…·å‡½æ•°å‘½åæ¸…æ™°ã€ä¸€è‡´
- [ ] é¿å…ç¼©å†™å’Œæ¨¡ç³Šå‘½å

**ç¤ºä¾‹**:
- æœåŠ¡å™¨å: `awslabs.costq-risp-mcp-server`
- åŒ…å: `costq_risp_mcp_server`

---

### 1.2 å·¥å…·è®¾è®¡

- [ ] æ˜ç¡®å·¥å…·æ•°é‡å’ŒåŠŸèƒ½
- [ ] å·¥å…·ä¹‹é—´èŒè´£æ¸…æ™°ã€æ— é‡å 
- [ ] æ¯ä¸ªå·¥å…·éƒ½æœ‰æ˜ç¡®çš„ç”¨æˆ·åœºæ™¯
- [ ] å·¥å…·æè¿°å®Œæ•´ã€æ˜“æ‡‚

---

## ğŸ“‹ é˜¶æ®µ 2: ä»£ç å¼€å‘

### 2.1 å·¥å…·å‡½æ•°ç­¾åï¼ˆâš ï¸ å…³é”®ï¼‰

- [ ] âœ… **æ‰€æœ‰å‚æ•°ä½¿ç”¨ç®€å•ç±»å‹** (`str`, `int`, `bool`, `list`, `dict`)
- [ ] âœ… **æ‰€æœ‰å‚æ•°ä½¿ç”¨ `Annotated[type, Field(description=...)]`**
- [ ] âŒ **æ²¡æœ‰å¤æ‚ Pydantic æ¨¡å‹å‚æ•°**ï¼ˆå¦‚ `params: MyModel`ï¼‰
- [ ] âŒ **æ²¡æœ‰åµŒå¥—å¯¹è±¡å‚æ•°**
- [ ] å¿…éœ€å‚æ•°åœ¨å‰ï¼Œå¯é€‰å‚æ•°åœ¨å
- [ ] æ‰€æœ‰å¯é€‰å‚æ•°éƒ½æœ‰é»˜è®¤å€¼
- [ ] `target_account_id` å‚æ•°ï¼ˆå¦‚æœæ”¯æŒå¤šè´¦å·ï¼‰

**é”™è¯¯ç¤ºä¾‹**:
```python
âŒ async def my_tool(ctx: Context, params: ComplexModel):
```

**æ­£ç¡®ç¤ºä¾‹**:
```python
âœ… async def my_tool(
    ctx: Context,
    param1: Annotated[str, Field(description="...")],
    param2: Annotated[Optional[int], Field(description="...")] = None,
):
```

---

### 2.2 å‚æ•°æè¿°

- [ ] æ¯ä¸ªå‚æ•°éƒ½æœ‰ `description`
- [ ] æè¿°åŒ…å«å‚æ•°æ ¼å¼ï¼ˆå¦‚ `"YYYY-MM-DD format"`ï¼‰
- [ ] æè¿°åŒ…å«å¯é€‰å€¼ï¼ˆå¦‚ `"DAILY or MONTHLY"`ï¼‰
- [ ] æè¿°åŒ…å«ç¤ºä¾‹ï¼ˆå¦‚æœå¤æ‚ï¼‰
- [ ] æè¿°ç®€æ´æ¸…æ™°ï¼ˆä¸€å¥è¯ï¼‰

**ç¤ºä¾‹**:
```python
start_date: Annotated[str, Field(
    description="Start date in YYYY-MM-DD format (e.g., 2026-01-01)"
)]
```

---

### 2.3 FastMCP é…ç½®

- [ ] `name` ä½¿ç”¨ `awslabs.*` æ ¼å¼
- [ ] `host` è®¾ç½®ä¸º `"0.0.0.0"`
- [ ] `port` è®¾ç½®ä¸º `8000`
- [ ] `stateless_http` è®¾ç½®ä¸º `True`
- [ ] `instructions` å®Œæ•´æè¿°æœåŠ¡å™¨ç”¨é€”
- [ ] `dependencies` åˆ—å‡ºæ‰€æœ‰ Python ä¾èµ–

**æ¨¡æ¿**:
```python
mcp = FastMCP(
    name="awslabs.<your-project>-<service>-mcp-server",
    instructions="...",
    dependencies=['boto3', 'pydantic'],
    host="0.0.0.0",
    stateless_http=True,
    port=8000
)
```

---

## ğŸ“‹ é˜¶æ®µ 3: Dockerfile é…ç½®

### 3.1 ä¾èµ–ç‰ˆæœ¬

- [ ] æ‰€æœ‰ä¾èµ–ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬ï¼ˆ`==`ï¼‰
- [ ] `pydantic` ç‰ˆæœ¬ >= 2.11.0
- [ ] `mcp[cli]` ç‰ˆæœ¬ä¸º 1.23.3 æˆ–æ›´é«˜
- [ ] `boto3` ç‰ˆæœ¬é”å®š
- [ ] å…¶ä»–ä¾èµ–ç‰ˆæœ¬é”å®š

**å…³é”®ç‰ˆæœ¬**:
```dockerfile
pydantic==2.11.7       # å¿…é¡» >=2.11.0
mcp[cli]==1.23.3
boto3==1.38.22
```

---

### 3.2 å¥åº·æ£€æŸ¥

- [ ] âœ… ä½¿ç”¨è¿›ç¨‹å­˜æ´»æ£€æŸ¥
- [ ] âŒ ä¸ä½¿ç”¨ `GET /mcp`ï¼ˆPOST-only ç«¯ç‚¹ï¼‰
- [ ] `--interval` è®¾ç½®ä¸º 30s
- [ ] `--timeout` è®¾ç½®ä¸º 5s
- [ ] `--start-period` è®¾ç½®ä¸º 15s
- [ ] `--retries` è®¾ç½®ä¸º 3

**æ­£ç¡®é…ç½®**:
```dockerfile
HEALTHCHECK --interval=30s --timeout=5s --start-period=15s --retries=3 \
    CMD pgrep -f "python.*server" > /dev/null || exit 1
```

---

### 3.3 å¯åŠ¨å‘½ä»¤

- [ ] ä½¿ç”¨ `python -m` æ¨¡å—æ‰§è¡Œ
- [ ] åŒ…å« `opentelemetry-instrument`
- [ ] æ¨¡å—è·¯å¾„æ­£ç¡®ï¼ˆ`awslabs.<package>.server`ï¼‰

**æ¨¡æ¿**:
```dockerfile
CMD ["opentelemetry-instrument", "python", "-m", "awslabs.<your_package>.server"]
```

---

## ğŸ“‹ é˜¶æ®µ 4: åŒ…ç»“æ„

### 4.1 ç›®å½•ç»“æ„

- [ ] `pyproject.toml` å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- [ ] `awslabs/` å‘½åç©ºé—´ç›®å½•å­˜åœ¨
- [ ] `awslabs/<your_package>/` ä¸»åŒ…ç›®å½•å­˜åœ¨
- [ ] `server.py` åœ¨ä¸»åŒ…ç›®å½•ä¸­
- [ ] `handlers/` ç›®å½•å­˜åœ¨ï¼ˆå¦‚æœæœ‰å¤šä¸ªå·¥å…·ï¼‰
- [ ] `models/` ç›®å½•å­˜åœ¨ï¼ˆå¦‚æœæœ‰æ•°æ®æ¨¡å‹ï¼‰
- [ ] `tests/` ç›®å½•å­˜åœ¨

---

### 4.2 pyproject.toml

- [ ] `name` ä¸º `awslabs.<your-project>-<service>-mcp-server`
- [ ] `version` æ­£ç¡®
- [ ] `description` å®Œæ•´
- [ ] `dependencies` åˆ—è¡¨å®Œæ•´
- [ ] `requires-python` è®¾ç½®ä¸º `>=3.10`
- [ ] `[build-system]` é…ç½®æ­£ç¡®

---

## ğŸ“‹ é˜¶æ®µ 5: æœ¬åœ°æµ‹è¯•

### 5.1 é•œåƒæ„å»º

- [ ] é•œåƒæˆåŠŸæ„å»ºï¼ˆæ— é”™è¯¯ï¼‰
- [ ] æ„å»ºæ—¶é—´åˆç†ï¼ˆ< 10 åˆ†é’Ÿï¼‰
- [ ] é•œåƒå¤§å°åˆç†ï¼ˆ< 500 MBï¼‰

**å‘½ä»¤**:
```bash
docker build -f Dockerfile-AgentCore-Runtime -t <your-mcp>:test .
```

---

### 5.2 å®¹å™¨å¯åŠ¨

- [ ] å®¹å™¨æˆåŠŸå¯åŠ¨
- [ ] å®¹å™¨çŠ¶æ€ä¸º `(healthy)`ï¼ˆç­‰å¾… 30 ç§’åæ£€æŸ¥ï¼‰
- [ ] æ— é”™è¯¯æ—¥å¿—

**å‘½ä»¤**:
```bash
docker run -d --name test-mcp -p 8000:8000 <your-mcp>:test
docker ps | grep test-mcp
docker logs test-mcp
```

---

### 5.3 å·¥å…·åˆ—è¡¨éªŒè¯

- [ ] `tools/list` è¯·æ±‚æˆåŠŸï¼ˆ200 OKï¼‰
- [ ] è¿”å›çš„å·¥å…·æ•°é‡æ­£ç¡®
- [ ] æ¯ä¸ªå·¥å…·éƒ½æœ‰ `name`, `description`, `inputSchema`
- [ ] JSON æ ¼å¼æ­£ç¡®

**å‘½ä»¤**:
```bash
curl -X POST http://localhost:8000/mcp \
  -H "Content-Type: application/json" \
  -H "Accept: application/json, text/event-stream" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}'
```

---

### 5.4 JSON Schema éªŒè¯

- [ ] âœ… æ‰€æœ‰å‚æ•°ç±»å‹ä¸ºç®€å•ç±»å‹
- [ ] âŒ æ— åµŒå¥—å¯¹è±¡ï¼ˆæ—  `properties` åµŒå¥—ï¼‰
- [ ] æ¯ä¸ªå‚æ•°éƒ½æœ‰ `description`
- [ ] `required` å­—æ®µæ­£ç¡®
- [ ] å‚æ•°é¡ºåºåˆç†

**éªŒè¯è„šæœ¬**:
```python
# æ£€æŸ¥æ˜¯å¦æœ‰åµŒå¥— properties
for tool in tools:
    for param in tool['inputSchema']['properties'].values():
        assert 'properties' not in param, "å‘ç°åµŒå¥—å¯¹è±¡ï¼"
        assert 'description' in param, "ç¼ºå°‘ descriptionï¼"
```

---

## ğŸ“‹ é˜¶æ®µ 6: éƒ¨ç½²å‡†å¤‡

### 6.1 ECR æ¨é€

- [ ] é•œåƒæˆåŠŸæ¨é€åˆ° ECR
- [ ] é•œåƒæ ‡ç­¾æ­£ç¡®ï¼ˆ`latest` + ç‰ˆæœ¬æ ‡ç­¾ï¼‰
- [ ] ECR ä»“åº“åç§°æ­£ç¡®

**å‘½ä»¤**:
```bash
bash costq/scripts/build_and_push_template.sh <your-mcp-server>
```

---

### 6.2 æ–‡æ¡£

- [ ] README.md å®Œæ•´ï¼ˆæœåŠ¡å™¨ä»‹ç»ã€å·¥å…·åˆ—è¡¨ã€ä½¿ç”¨ç¤ºä¾‹ï¼‰
- [ ] å·¥å…·æ–‡æ¡£å®Œæ•´ï¼ˆæ¯ä¸ªå·¥å…·çš„ç”¨é€”ã€å‚æ•°ã€è¿”å›å€¼ï¼‰
- [ ] éƒ¨ç½²æ–‡æ¡£å®Œæ•´
- [ ] ç¤ºä¾‹ä»£ç å®Œæ•´

---

## ğŸ“‹ é˜¶æ®µ 7: AgentCore Runtime éƒ¨ç½²

### 7.1 Runtime æ›´æ–°

- [ ] Runtime æˆåŠŸæ›´æ–°åˆ°æ–°é•œåƒ
- [ ] Runtime çŠ¶æ€ä¸º `ACTIVE`
- [ ] Runtime å¥åº·æ£€æŸ¥é€šè¿‡

**å‘½ä»¤**:
```bash
aws bedrock-agentcore-control update-runtime \
  --runtime-identifier <runtime-id> \
  --container-image <ecr-uri>:latest \
  --profile 3532 \
  --region ap-northeast-1
```

---

### 7.2 Gateway åˆ·æ–°

- [ ] Gateway å·²åˆ·æ–°
- [ ] Gateway å¯ä»¥å‘ç°æ–°å·¥å…·
- [ ] Gateway çŠ¶æ€æ­£å¸¸

---

### 7.3 åŠŸèƒ½éªŒè¯

- [ ] Agent å¯ä»¥è°ƒç”¨å·¥å…·
- [ ] å·¥å…·å“åº”æ—¶é—´æ­£å¸¸ï¼ˆ> 7msï¼Œè¯´æ˜è¯·æ±‚åˆ°è¾¾ Runtimeï¼‰
- [ ] å·¥å…·è¿”å›ç»“æœæ­£ç¡®
- [ ] æ—¥å¿—ä¸­å¯è§ `tools/call` è¯·æ±‚
- [ ] æ—¥å¿—ä¸­å¯è§ AWS API è°ƒç”¨ï¼ˆå¦‚æœæœ‰ï¼‰

---

## ğŸ“‹ é˜¶æ®µ 8: ç”Ÿäº§éªŒè¯

### 8.1 æ€§èƒ½æµ‹è¯•

- [ ] å•ä¸ªå·¥å…·è°ƒç”¨å“åº”æ—¶é—´ < 5s
- [ ] å¹¶å‘è°ƒç”¨æ— é”™è¯¯
- [ ] å†…å­˜ä½¿ç”¨æ­£å¸¸ï¼ˆ< 512 MBï¼‰
- [ ] CPU ä½¿ç”¨æ­£å¸¸

---

### 8.2 é”™è¯¯å¤„ç†

- [ ] å‚æ•°éªŒè¯é”™è¯¯è¿”å›æ¸…æ™°æ¶ˆæ¯
- [ ] AWS API é”™è¯¯æ­£ç¡®å¤„ç†
- [ ] è¶…æ—¶é”™è¯¯æ­£ç¡®å¤„ç†
- [ ] æ—¥å¿—è®°å½•å®Œæ•´

---

### 8.3 ç›‘æ§ä¸å‘Šè­¦

- [ ] CloudWatch æ—¥å¿—æ­£å¸¸
- [ ] é”™è¯¯å‘Šè­¦é…ç½®å®Œæˆ
- [ ] æ€§èƒ½ç›‘æ§é…ç½®å®Œæˆ

---

## âœ… æœ€ç»ˆç¡®è®¤

### å…³é”®æ£€æŸ¥é¡¹ï¼ˆå¿…é¡»å…¨éƒ¨é€šè¿‡ï¼‰

- [ ] âœ… **å·¥å…·å‡½æ•°ç­¾åä½¿ç”¨ç®€å•ç±»å‹**ï¼ˆæ—  Pydantic æ¨¡å‹å‚æ•°ï¼‰
- [ ] âœ… **å¥åº·æ£€æŸ¥ä½¿ç”¨è¿›ç¨‹å­˜æ´»æ£€æŸ¥**ï¼ˆä¸æ˜¯ GET /mcpï¼‰
- [ ] âœ… **pydantic ç‰ˆæœ¬ >= 2.11.0**
- [ ] âœ… **FastMCP name ä½¿ç”¨ awslabs æ ¼å¼**
- [ ] âœ… **å®¹å™¨å¯åŠ¨åçŠ¶æ€ä¸º healthy**
- [ ] âœ… **å·¥å…·åˆ—è¡¨è¿”å›æ­£ç¡®æ•°é‡çš„å·¥å…·**
- [ ] âœ… **JSON Schema æ— åµŒå¥—å¯¹è±¡**
- [ ] âœ… **Agent å¯ä»¥æˆåŠŸè°ƒç”¨å·¥å…·**

---

## ğŸ“ æ£€æŸ¥ç»“æœ

**æ€»è®¡æ£€æŸ¥é¡¹**: 100+
**é€šè¿‡é¡¹**: _____ / _____
**å¤±è´¥é¡¹**: _____ / _____

**å…³é”®é—®é¢˜**:
1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
1. _______________________________________________
2. _______________________________________________
3. _______________________________________________

---

## ğŸ”— å‚è€ƒæ–‡æ¡£

- [ ] å·²é˜…è¯» `MCP_SERVER_å¼€å‘è§„èŒƒ.md`
- [ ] å·²é˜…è¯» `MCP_SERVER_å¿«é€Ÿå‚è€ƒ.md`
- [ ] å·²å‚è€ƒ `cloudtrail-mcp-server` ç¤ºä¾‹
- [ ] å·²å‚è€ƒ `costq-risp-mcp-server` ç¤ºä¾‹

---

**æ£€æŸ¥äººå‘˜**: _______________
**å®¡æ ¸äººå‘˜**: _______________
**æ—¥æœŸ**: _______________
**ç‰ˆæœ¬**: v1.0 (2026-01-20)
