# costq-risp-mcp-server filter_expression å‚æ•°ä¿®å¤è®¡åˆ’

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

**ç›®æ ‡:** ä¿®å¤ `filter_expression` å‚æ•°çš„ç±»å‹å®šä¹‰é—®é¢˜,ä½¿å…¶ä¸ Bedrock AgentCore çš„ Schema éªŒè¯å…¼å®¹ã€‚

**æ ¹æœ¬åŸå› :** `filter_expression` å®šä¹‰ä¸º `Optional[dict]` å¯¼è‡´ç”Ÿæˆçš„ Schema ç¼ºå°‘ `type: object` å®šä¹‰,è§¦å‘ Schema éªŒè¯å¤±è´¥ã€‚

**è§£å†³æ–¹æ¡ˆ:** éµå¾ª `billing-cost-management-mcp-server` çš„æœ€ä½³å®è·µ,æ”¹ä¸º `Optional[str]` ç±»å‹å¹¶åœ¨å†…éƒ¨è§£æã€‚

**å‚è€ƒæ–‡æ¡£:**
- DEVELOPER_GUIDE.md - å¼€å‘æµç¨‹å’Œæµ‹è¯•è§„èŒƒ
- DEEPV.md - ç¼–ç è§„èŒƒå’Œå®‰å…¨åŸåˆ™
- CODING_STANDARDS.md - Python ç¼–ç æ ‡å‡†
- costq/docs/20260120_filter_expressionåˆ†æ/step6_æ ¹æœ¬åŸå› åˆ†æ.md - è¯¦ç»†æŠ€æœ¯åˆ†æ

---

## ğŸ“‚ å½±å“èŒƒå›´ (å·²å®Œæ•´ç¡®è®¤)

### ä¿®æ”¹æ–‡ä»¶

**Handler å±‚ (å¿…é¡»ä¿®æ”¹):**
1. `src/costq-risp-mcp-server/handlers/sp_handler.py` - 4ä¸ªå‡½æ•°
2. `src/costq-risp-mcp-server/handlers/ri_handler.py` - 2ä¸ªå‡½æ•°

**Model å±‚ (ä¸éœ€è¦ä¿®æ”¹):**
- `models/common_models.py` - FilterExpression ç±»ä¿æŒä¸å˜,ç”¨äºéªŒè¯è§£æåçš„dict
- `models/sp_models.py` - ä¿æŒä¸å˜
- `models/ri_models.py` - ä¿æŒä¸å˜

**Utils å±‚ (ä¸éœ€è¦ä¿®æ”¹):**
- `utils/validators.py` - éªŒè¯å‡½æ•°ç»§ç»­æ¥æ”¶dictç±»å‹

**å¯èƒ½éœ€è¦ä¿®æ”¹çš„æµ‹è¯•æ–‡ä»¶:**
- `src/costq-risp-mcp-server/tests/test_sp_handler.py` (å¦‚æœå­˜åœ¨)
- `src/costq-risp-mcp-server/tests/test_ri_handler.py` (å¦‚æœå­˜åœ¨)

### å½±å“çš„å‡½æ•° (å…±6ä¸ª)

#### sp_handler.py (4ä¸ªå‡½æ•°)

1. **L61:** `get_savings_plans_coverage()` - Savings Plans è¦†ç›–ç‡æŸ¥è¯¢
2. **L296:** `get_savings_plans_utilization()` - Savings Plans åˆ©ç”¨ç‡æŸ¥è¯¢
3. **L550:** `get_savings_plans_utilization_detail()` - Savings Plans è¯¦ç»†åˆ©ç”¨ç‡æŸ¥è¯¢
4. **L885:** `get_savings_plans_utilization_details()` - Savings Plans è¯¦ç»†åˆ©ç”¨ç‡æŸ¥è¯¢(å¦ä¸€ä¸ªç‰ˆæœ¬)

#### ri_handler.py (2ä¸ªå‡½æ•°)

5. **L68:** `get_reservation_coverage()` - RI è¦†ç›–ç‡æŸ¥è¯¢
6. **L281:** `get_reservation_utilization()` - RI åˆ©ç”¨ç‡æŸ¥è¯¢

**æ€»è®¡:** 2ä¸ªæ–‡ä»¶, 6ä¸ªå‡½æ•°, æ‰€æœ‰éƒ½éœ€è¦ä¿®æ”¹

---

## ğŸ¯ ä¿®æ”¹è®¡åˆ’

### Phase 1: ä»£ç å‡†å¤‡å’ŒéªŒè¯ (å·²å®Œæˆ âœ…)

#### 1.1 å®Œæ•´ä»£ç åˆ†æ âœ…
å·²å®Œæˆå®Œæ•´çš„ä»£ç æ‰«æå’Œå½±å“èŒƒå›´åˆ†æ:
- âœ… ç¡®è®¤ 2 ä¸ªæ–‡ä»¶éœ€è¦ä¿®æ”¹
- âœ… ç¡®è®¤ 6 ä¸ªå‡½æ•°éœ€è¦ä¿®æ”¹
- âœ… ç¡®è®¤ Model å±‚å’Œ Utils å±‚ä¸éœ€è¦ä¿®æ”¹

**å‚è€ƒæ–‡æ¡£:**
- `costq/docs/20260120_filter_expressionåˆ†æ/å®Œæ•´å½±å“èŒƒå›´åˆ†æ.md`
- `costq/docs/20260120_filter_expressionåˆ†æ/æ‰§è¡Œæ‘˜è¦.md`

#### 1.2 å‚è€ƒå®ç°ç¡®è®¤ âœ…
å·²ç¡®è®¤ `billing-cost-management-mcp-server` çš„å®ç°æ¨¡å¼:
- âœ… å‚æ•°ç±»å‹: `Optional[str]`
- âœ… JSON è§£æ: `json.loads()` + é”™è¯¯å¤„ç†
- âœ… æ—¥å¿—è®°å½•: `logger.error()` éµå¾ª CODING_STANDARDS.md

**å‚è€ƒæ–‡ä»¶:**
- `src/billing-cost-management-mcp-server/tools/sp_performance_tools.py`
- `src/billing-cost-management-mcp-server/utilities/aws_service_base.py`

---

### Phase 2: ä»£ç ä¿®æ”¹ (1å°æ—¶)

#### 2.1 ä¿®æ”¹å‚æ•°ç±»å‹å®šä¹‰

**åŸåˆ™:**
- âœ… éµå¾ª CODING_STANDARDS.md çš„é›¶ä¾µå…¥æ€§åŸåˆ™
- âœ… ä¸æ”¹å˜ä¸šåŠ¡é€»è¾‘å’Œå‡½æ•°ç­¾å(åªæ”¹å‚æ•°ç±»å‹)
- âœ… ä½¿ç”¨æœ€ç®€å•çš„æ–¹æ¡ˆ,é¿å…è¿‡åº¦è®¾è®¡

**ä¿®æ”¹å†…å®¹ (æ¯ä¸ªå‡½æ•°):**

**ä¿®æ”¹å‰:**
```python
filter_expression: Annotated[
    Optional[dict],
    Field(
        description="Filter expression for Cost Explorer API. ..."
    ),
] = None,
```

**ä¿®æ”¹å:**
```python
filter_expression: Annotated[
    Optional[str],
    Field(
        description=(
            "Filter expression for Cost Explorer API as a JSON string. "
            "Example: '{\"Dimensions\": {\"Key\": \"SERVICE\", "
            "\"Values\": [\"Amazon Elastic Compute Cloud - Compute\"]}}'"
        )
    ),
] = None,
```

**å…³é”®ç‚¹:**
1. `Optional[dict]` â†’ `Optional[str]`
2. æ›´æ–° `description` è¯´æ˜è¦ä¼ é€’ JSON å­—ç¬¦ä¸²
3. æä¾›æ˜ç¡®çš„ä½¿ç”¨ç¤ºä¾‹

#### 2.2 æ·»åŠ  JSON è§£æé€»è¾‘

**ä½ç½®:** åœ¨æ¯ä¸ªå‡½æ•°ä¸­,ä½¿ç”¨ `filter_expression` ä¹‹å‰æ·»åŠ è§£æ

**æ·»åŠ å†…å®¹ (æ¯ä¸ªå‡½æ•°):**

**ä¿®æ”¹å‰:**
```python
if filter_expression:
    request_params['Filter'] = filter_expression
```

**ä¿®æ”¹å:**
```python
# Parse filter_expression from JSON string if provided
filter_dict = None
if filter_expression:
    try:
        filter_dict = json.loads(filter_expression)
    except json.JSONDecodeError as e:
        logger.error(
            "Invalid JSON format for filter_expression parameter: %s",
            str(e)
        )
        raise ValueError(
            f"Invalid JSON format for filter_expression: {e}"
        )

# Use parsed filter in request
if filter_dict:
    request_params['Filter'] = filter_dict
```

**å…³é”®ç‚¹:**
1. ä½¿ç”¨æ ‡å‡†åº“ `json.loads()` è§£æ
2. æ•è· `json.JSONDecodeError` å¼‚å¸¸
3. ä½¿ç”¨ `logger.error()` è®°å½•é”™è¯¯(éµå¾ª CODING_STANDARDS.md)
4. æŠ›å‡º `ValueError` ç»™è°ƒç”¨æ–¹

#### 2.3 ç¡®ä¿ json æ¨¡å—å·²å¯¼å…¥

**æ£€æŸ¥æ–‡ä»¶é¡¶éƒ¨çš„å¯¼å…¥:**
```python
import json  # ç¡®ä¿å·²å¯¼å…¥
```

å¦‚æœæ²¡æœ‰,åœ¨æ ‡å‡†åº“å¯¼å…¥åŒºåŸŸæ·»åŠ ã€‚

#### 2.4 ä¿®æ”¹æ¸…å•

**æ–‡ä»¶1: handlers/sp_handler.py (4ä¸ªå‡½æ•°)**
- [ ] `get_savings_plans_coverage()` (L61, L202-203)
- [ ] `get_savings_plans_utilization()` (L296, L446-447)
- [ ] `get_savings_plans_utilization_detail()` (L550, L663-664)
- [ ] `get_savings_plans_utilization_details()` (L885, L991-992)

**æ–‡ä»¶2: handlers/ri_handler.py (2ä¸ªå‡½æ•°)**
- [ ] `get_reservation_coverage()` (L68, L186-187)
- [ ] `get_reservation_utilization()` (L281, L400-401)

**æ¯ä¸ªå‡½æ•°çš„ä¿®æ”¹æ­¥éª¤:**
1. ä¿®æ”¹å‚æ•°ç±»å‹å®šä¹‰: `Optional[dict]` â†’ `Optional[str]`
2. æ›´æ–°å‚æ•°æè¿°,è¯´æ˜è¦ä¼ é€’JSONå­—ç¬¦ä¸²,æ·»åŠ ç¤ºä¾‹
3. åœ¨ä½¿ç”¨å‰æ·»åŠ  JSON è§£æé€»è¾‘ (`json.loads()`)
4. æ·»åŠ é”™è¯¯å¤„ç† (æ•è· `json.JSONDecodeError`)
5. ç«‹å³è¿›è¡Œä»£ç çº§éªŒè¯(è¯­æ³•ã€ç¼©è¿›ã€é€»è¾‘)

---

### Phase 3: æœ¬åœ°æµ‹è¯• (1å°æ—¶)

#### 3.1 è¯­æ³•æ£€æŸ¥
```bash
cd src/costq-risp-mcp-server

# ä½¿ç”¨ ruff æ£€æŸ¥è¯­æ³•
ruff check awslabs/

# ç±»å‹æ£€æŸ¥(å¦‚æœæœ‰é…ç½®)
# mypy awslabs/
```

**é¢„æœŸè¾“å‡º:** æ— è¯­æ³•é”™è¯¯,æ— ç±»å‹è­¦å‘Š

#### 3.2 å•å…ƒæµ‹è¯•(å¦‚æœå­˜åœ¨)
```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
uv run --frozen pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
uv run --frozen pytest tests/test_sp_handler.py -v
```

**é¢„æœŸè¾“å‡º:** æ‰€æœ‰æµ‹è¯•é€šè¿‡

#### 3.3 MCP Inspector æµ‹è¯•

**å‚è€ƒ DEVELOPER_GUIDE.md:**
```bash
# ä½¿ç”¨ MCP Inspector æœ¬åœ°æµ‹è¯•
npx @modelcontextprotocol/inspector \
  uv \
  --directory /Users/liyuguang/data/gitworld/tonygithub/costq-mcp-servers/src/costq-risp-mcp-server/awslabs/costq_risp_mcp_server \
  run \
  server.py
```

**æµ‹è¯•åœºæ™¯:**
1. æ‰“å¼€ Inspector ç•Œé¢
2. è°ƒç”¨ `get_savings_plans_coverage` å·¥å…·
3. ä¼ é€’å‚æ•°:
   ```json
   {
     "start_date": "2026-01-01",
     "end_date": "2026-01-20",
     "granularity": "DAILY",
     "filter_expression": "{\"Dimensions\": {\"Key\": \"SERVICE\", \"Values\": [\"Amazon Elastic Compute Cloud - Compute\"]}}",
     "target_account_id": "859082029538"
   }
   ```
4. éªŒè¯è¿”å›æ­£å¸¸æ•°æ®,æ— å¼‚å¸¸

**é¢„æœŸè¾“å‡º:** å·¥å…·è°ƒç”¨æˆåŠŸ,è¿”å›æˆæœ¬æ•°æ®

---

### Phase 4: éƒ¨ç½²å’ŒéªŒè¯ (1å°æ—¶)

#### 4.1 æäº¤ä»£ç 

**éµå¾ª CODING_STANDARDS.md çš„ Git æäº¤è§„èŒƒ:**
```bash
git add src/costq-risp-mcp-server/handlers/sp_handler.py
git commit -m "fix(risp-mcp): ä¿®å¤ filter_expression å‚æ•°ç±»å‹é—®é¢˜

- å°† filter_expression ä» dict æ”¹ä¸º str ç±»å‹
- æ·»åŠ  JSON è§£æé€»è¾‘,å†…éƒ¨è½¬æ¢ä¸º dict
- æ›´æ–°å‚æ•°æ–‡æ¡£,è¯´æ˜è¦ä¼ é€’ JSON å­—ç¬¦ä¸²
- ä¿®å¤ Bedrock AgentCore Schema éªŒè¯å¤±è´¥é—®é¢˜

å½±å“å‡½æ•°:
- get_savings_plans_coverage
- get_savings_plans_utilization
- get_savings_plans_utilization_detail
- get_reservation_coverage

å‚è€ƒ: billing-cost-management-mcp-server çš„å®ç°æ¨¡å¼

Closes #filter_expression_issue
"
```

#### 4.2 æ„å»ºå’Œéƒ¨ç½²

**å‚è€ƒ DEEPV.md çš„éƒ¨ç½²æµç¨‹:**
```bash
# 1. æ„å»ºé•œåƒå¹¶ä¸Šä¼ åˆ° ECR
cd costq/scripts
./build_and_push.sh costq-risp-mcp-server

# 2. æ›´æ–° Runtime (æ‰‹åŠ¨æ“ä½œ)
# åœ¨ AWS Console ä¸­æ›´æ–° costq_risp_mcp_production Runtime

# 3. åˆ·æ–° Gateway (é‡è¦!)
aws bedrock-agentcore-control --profile 3532 --region ap-northeast-1 \
  refresh-gateway \
  --gateway-id costq-aws-mcp-gateway-production-c3svyct5ay
```

**é¢„æœŸè¾“å‡º:**
- é•œåƒæ„å»ºæˆåŠŸ
- Runtime æ›´æ–°æˆåŠŸ
- Gateway åˆ·æ–°æˆåŠŸ

#### 4.3 ç”Ÿäº§ç¯å¢ƒéªŒè¯

**æµ‹è¯•åœºæ™¯ 1: Savings Plans è¦†ç›–ç‡æŸ¥è¯¢**
```bash
# ä½¿ç”¨ AWS CLI è°ƒç”¨ Gateway å·¥å…·
aws bedrock-agentcore-control --profile 3532 --region ap-northeast-1 \
  invoke-tool \
  --gateway-id costq-aws-mcp-gateway-production-c3svyct5ay \
  --tool-name "costq-risp-mcp-production___get_sp_coverage" \
  --tool-input '{
    "start_date": "2026-01-17",
    "end_date": "2026-01-21",
    "granularity": "DAILY",
    "filter_expression": "{\"Dimensions\": {\"Key\": \"SERVICE\", \"Values\": [\"Amazon Elastic Compute Cloud - Compute\"]}}",
    "target_account_id": "859082029538"
  }'
```

**é¢„æœŸè¾“å‡º:**
- âœ… è°ƒç”¨æˆåŠŸ,æ—  JsonSchemaException
- âœ… è¿”å›æ­£ç¡®çš„è¦†ç›–ç‡æ•°æ®

**æµ‹è¯•åœºæ™¯ 2: ElastiCache RI è¦†ç›–ç‡æŸ¥è¯¢**
```bash
aws bedrock-agentcore-control --profile 3532 --region ap-northeast-1 \
  invoke-tool \
  --gateway-id costq-aws-mcp-gateway-production-c3svyct5ay \
  --tool-name "costq-risp-mcp-production___get_sp_coverage" \
  --tool-input '{
    "start_date": "2026-01-17",
    "end_date": "2026-01-21",
    "granularity": "DAILY",
    "filter_expression": "{\"Dimensions\": {\"Key\": \"SERVICE\", \"Values\": [\"Amazon ElastiCache\"]}}",
    "target_account_id": "859082029538"
  }'
```

**é¢„æœŸè¾“å‡º:** åŒä¸Š

**æµ‹è¯•åœºæ™¯ 3: RI è¦†ç›–ç‡æŸ¥è¯¢ (ri_handler)**
```bash
aws bedrock-agentcore-control --profile 3532 --region ap-northeast-1 \
  invoke-tool \
  --gateway-id costq-aws-mcp-gateway-production-c3svyct5ay \
  --tool-name "costq-risp-mcp-production___get_reservation_coverage" \
  --tool-input '{
    "start_date": "2026-01-17",
    "end_date": "2026-01-21",
    "granularity": "DAILY",
    "filter_expression": "{\"Dimensions\": {\"Key\": \"SERVICE\", \"Values\": [\"Amazon Relational Database Service\"]}}",
    "target_account_id": "859082029538"
  }'
```

**é¢„æœŸè¾“å‡º:** RI è¦†ç›–ç‡æ•°æ®æ­£å¸¸è¿”å›

**æµ‹è¯•åœºæ™¯ 4: RI åˆ©ç”¨ç‡æŸ¥è¯¢ (ri_handler)**
```bash
aws bedrock-agentcore-control --profile 3532 --region ap-northeast-1 \
  invoke-tool \
  --gateway-id costq-aws-mcp-gateway-production-c3svyct5ay \
  --tool-name "costq-risp-mcp-production___get_reservation_utilization" \
  --tool-input '{
    "start_date": "2026-01-01",
    "end_date": "2026-01-20",
    "granularity": "MONTHLY",
    "target_account_id": "859082029538"
  }'
```

**é¢„æœŸè¾“å‡º:** RI åˆ©ç”¨ç‡æ•°æ®æ­£å¸¸è¿”å›

#### 4.4 æŸ¥çœ‹æ—¥å¿—éªŒè¯

```bash
# æŸ¥çœ‹ Runtime æ—¥å¿—
aws logs filter-log-events --profile 3532 --region ap-northeast-1 \
  --log-group-name /aws/bedrock-agentcore/runtimes/costq_risp_mcp_production-6ypFN96HS4-DEFAULT \
  --start-time $(python3 -c "import time; print(int((time.time() - 300) * 1000))") \
  --filter-pattern "filter_expression"

# æŸ¥çœ‹ Gateway æ—¥å¿—
aws logs filter-log-events --profile 3532 --region ap-northeast-1 \
  --log-group-name /aws/vendedlogs/bedrock-agentcore/gateway/APPLICATION_LOGS/costq-aws-mcp-gateway-production-c3svyct5ay \
  --start-time $(python3 -c "import time; print(int((time.time() - 300) * 1000))") \
  --filter-pattern "JsonSchemaException"
```

**é¢„æœŸè¾“å‡º:**
- âœ… æ—  JsonSchemaException é”™è¯¯
- âœ… æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸çš„å·¥å…·è°ƒç”¨å’Œè¿”å›

---

## âœ… éªŒè¯æ¸…å•

### ä»£ç è´¨é‡éªŒè¯
- [ ] è¯­æ³•æ£€æŸ¥é€šè¿‡ (`ruff check`)
- [ ] ç±»å‹æ£€æŸ¥é€šè¿‡ (å¦‚æœæœ‰é…ç½®)
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ (`pytest`)
- [ ] ä»£ç éµå¾ª CODING_STANDARDS.md è§„èŒƒ
- [ ] æ—¥å¿—ä½¿ç”¨ `logger.error()` è€Œé `print()`
- [ ] å¼‚å¸¸å¤„ç†è§„èŒƒ (æ•è· `json.JSONDecodeError`)
- [ ] å‚æ•°æ–‡æ¡£æ›´æ–°,åŒ…å« JSON å­—ç¬¦ä¸²ç¤ºä¾‹

### æœ¬åœ°æµ‹è¯•éªŒè¯
- [ ] MCP Inspector æµ‹è¯•é€šè¿‡
- [ ] èƒ½æ­£ç¡®è§£æ JSON å­—ç¬¦ä¸²
- [ ] èƒ½æ­£ç¡®å¤„ç†æ— æ•ˆ JSON å¹¶æŠ›å‡ºå¼‚å¸¸
- [ ] filter_expression=None çš„æƒ…å†µæ­£å¸¸å·¥ä½œ

### éƒ¨ç½²éªŒè¯
- [ ] é•œåƒæ„å»ºæˆåŠŸ
- [ ] Runtime æ›´æ–°æˆåŠŸ
- [ ] Gateway åˆ·æ–°æˆåŠŸ
- [ ] ç”Ÿäº§ç¯å¢ƒå·¥å…·è°ƒç”¨æˆåŠŸ
- [ ] æ—  JsonSchemaException é”™è¯¯
- [ ] è¿”å›æ•°æ®æ­£ç¡®

### åŠŸèƒ½éªŒè¯
- [ ] EC2 Savings Plans è¦†ç›–ç‡æŸ¥è¯¢æ­£å¸¸ (sp_handler)
- [ ] Savings Plans åˆ©ç”¨ç‡æŸ¥è¯¢æ­£å¸¸ (sp_handler)
- [ ] Savings Plans è¯¦ç»†åˆ©ç”¨ç‡æŸ¥è¯¢æ­£å¸¸ (sp_handler)
- [ ] RDS RI è¦†ç›–ç‡æŸ¥è¯¢æ­£å¸¸ (ri_handler)
- [ ] RI åˆ©ç”¨ç‡æŸ¥è¯¢æ­£å¸¸ (ri_handler)
- [ ] ElastiCache ç›¸å…³æŸ¥è¯¢æ­£å¸¸
- [ ] æ‰€æœ‰ 6 ä¸ªå‡½æ•°çš„ filter_expression éƒ½æ­£å¸¸å·¥ä½œ

### æ—¥å¿—éªŒè¯
- [ ] Runtime æ—¥å¿—æ— é”™è¯¯
- [ ] Gateway æ—¥å¿—æ—  Schema éªŒè¯é”™è¯¯
- [ ] AWS Spans è¿½è¸ªæ— å¼‚å¸¸

---

## ğŸ”„ å›æ»šè®¡åˆ’

**å¦‚æœå‡ºç°é—®é¢˜,ç«‹å³å›æ»š:**

```bash
# ä½¿ç”¨ Git å›æ»šåˆ°ä¿®æ”¹å‰çš„ç‰ˆæœ¬
git log --oneline -5  # æŸ¥çœ‹æœ€è¿‘çš„æäº¤å†å²
git revert <ä¿®å¤æäº¤çš„hash>  # åˆ›å»ºä¸€ä¸ªåå‘æäº¤
git push origin main

# æˆ–è€…ç›´æ¥é‡ç½®åˆ°ä¿®æ”¹å‰(ä¸æ¨è,é™¤éç´§æ€¥æƒ…å†µ)
git reset --hard <ä¿®æ”¹å‰çš„hash>
git push origin main --force

# é‡æ–°éƒ¨ç½²æ—§ç‰ˆæœ¬
cd costq/scripts
./build_and_push.sh costq-risp-mcp-server
# æ›´æ–° Runtime å’Œåˆ·æ–° Gateway
```

**å›æ»šåŸåˆ™:**
- âœ… ä¼˜å…ˆä½¿ç”¨ `git revert` (ä¿ç•™å†å²è®°å½•)
- âš ï¸  åªæœ‰ç´§æ€¥æƒ…å†µæ‰ä½¿ç”¨ `git reset --hard` (ä¼šä¸¢å¤±å†å²)
- âœ… å›æ»šåå¿…é¡»é‡æ–°éƒ¨ç½²å’Œåˆ·æ–° Gateway

---

## ğŸ“Š é¢„æœŸæ”¶ç›Š

### é—®é¢˜è§£å†³
- âœ… ä¿®å¤ `JsonSchemaException: string found, object expected` é”™è¯¯
- âœ… æ‰€æœ‰ filter_expression å‚æ•°è°ƒç”¨æ­£å¸¸
- âœ… ä¸ Bedrock AgentCore Schema éªŒè¯å®Œå…¨å…¼å®¹

### ä»£ç è´¨é‡æå‡
- âœ… éµå¾ª AWS å®˜æ–¹ MCP æœ€ä½³å®è·µ
- âœ… ä¸ billing-cost-management-mcp-server ä¿æŒä¸€è‡´
- âœ… ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æå‡
- âœ… å‚æ•°æ–‡æ¡£æ›´æ¸…æ™°

### ç³»ç»Ÿç¨³å®šæ€§
- âœ… é¿å…è¿è¡Œæ—¶ Schema éªŒè¯å¤±è´¥
- âœ… æ›´å¥½çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… å‘åå…¼å®¹æ€§å¼º

---

## ğŸš€ æ‰§è¡Œæ—¶é—´ä¼°ç®— (å·²æ›´æ–°)

| é˜¶æ®µ | ä»»åŠ¡ | åŸä¼°ç®— | æ–°ä¼°ç®— | è¯´æ˜ |
|------|------|--------|--------|------|
| Phase 1 | ä»£ç å‡†å¤‡å’ŒéªŒè¯ | 30åˆ†é’Ÿ | 30åˆ†é’Ÿ | å·²å®Œæˆå®Œæ•´åˆ†æ âœ… |
| Phase 2 | ä»£ç ä¿®æ”¹ | 1å°æ—¶ | 1.5å°æ—¶ | ä»4ä¸ªå‡½æ•°å¢åŠ åˆ°6ä¸ªå‡½æ•°,2ä¸ªæ–‡ä»¶ |
| Phase 3 | æœ¬åœ°æµ‹è¯• | 1å°æ—¶ | 1.5å°æ—¶ | éœ€è¦æµ‹è¯• SP å’Œ RI ä¸¤ç±»åŠŸèƒ½ |
| Phase 4 | éƒ¨ç½²å’ŒéªŒè¯ | 1å°æ—¶ | 1.5å°æ—¶ | éœ€è¦éªŒè¯6ä¸ªå‡½æ•°,4ä¸ªæµ‹è¯•åœºæ™¯ |
| **æ€»è®¡** | | **3.5å°æ—¶** | **5å°æ—¶** | +1.5å°æ—¶ |

**å»ºè®®æ‰§è¡Œæ—¶é—´:** é¢„ç•™ 5.5-6 å°æ—¶,åŒ…å«ç¼“å†²æ—¶é—´

**æ—¶é—´å¢åŠ åŸå› :**
- âœ… å½±å“èŒƒå›´æ‰©å¤§: ä» 1ä¸ªæ–‡ä»¶4ä¸ªå‡½æ•° â†’ 2ä¸ªæ–‡ä»¶6ä¸ªå‡½æ•°
- âœ… æµ‹è¯•èŒƒå›´æ‰©å¤§: éœ€è¦åŒæ—¶æµ‹è¯• SP å’Œ RI åŠŸèƒ½
- âœ… éªŒè¯æ›´å…¨é¢: 4ä¸ªæµ‹è¯•åœºæ™¯ç¡®ä¿æ‰€æœ‰å‡½æ•°éƒ½å·¥ä½œæ­£å¸¸

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### éµå¾ªçš„è§„èŒƒæ–‡æ¡£

1. **DEEPV.md**
   - âœ… é›¶ä¾µå…¥æ€§åŸåˆ™: ä»…ä¿®æ”¹ç›®æ ‡ä»£ç ,ä¸æ”¹å˜ä¸šåŠ¡é€»è¾‘
   - âœ… åˆ†æ­¥æ‰§è¡ŒéªŒè¯: Phase 1/2/3/4,æ¯æ­¥ç‹¬ç«‹éªŒè¯
   - âœ… é¿å…è¿‡åº¦è®¾è®¡: ä½¿ç”¨æœ€ç®€å•çš„æ–¹æ¡ˆ (str + json.loads)
   - âœ… åŸºäºå®é™…ä»£ç : å‚è€ƒ billing-cost-management-mcp-server
   - âœ… å®Œæ•´éªŒè¯æµç¨‹: ä»£ç çº§+éƒ¨ç½²å+åŠŸèƒ½+æ—¥å¿—éªŒè¯
   - âœ… è¯¦ç»†çš„æ‰§è¡Œè®¡åˆ’å’Œ Checklist
   - âœ… æ¯æ¬¡æ”¹åŠ¨åŸºäºæœ€å°èŒƒå›´ä¿®æ”¹åŸåˆ™

2. **CODING_STANDARDS.md**
   - âœ… ä½¿ç”¨æ ‡å‡† `import logging` å’Œ `logger = logging.getLogger(__name__)`
   - âœ… å¼‚å¸¸å¤„ç†ä½¿ç”¨ `logger.error(..., exc_info=True)`
   - âœ… ä¸ä½¿ç”¨ `print()`,ç»Ÿä¸€ä½¿ç”¨ `logger`
   - âœ… Git æäº¤éµå¾ª Conventional Commits è§„èŒƒ
   - âœ… ä»£ç æ ¼å¼: æ¯è¡Œ â‰¤100 å­—ç¬¦, 4ç©ºæ ¼ç¼©è¿›
   - âœ… ç±»å‹æ³¨è§£: ä½¿ç”¨ `Optional[str]`
   - âœ… æ–‡æ¡£å­—ç¬¦ä¸²: Google Style,è¯´æ˜å‚æ•°å’Œè¿”å›å€¼

3. **DEVELOPER_GUIDE.md**
   - âœ… ä½¿ç”¨ `uv run --frozen pytest` è¿è¡Œæµ‹è¯•
   - âœ… ä½¿ç”¨ MCP Inspector æœ¬åœ°æµ‹è¯•
   - âœ… pre-commit æ£€æŸ¥(æäº¤å‰è‡ªåŠ¨è¿è¡Œ)

### å…³é”®é£é™©

1. **æµ‹è¯•è¦†ç›–ä¸è¶³:** ç¡®ä¿æ‰€æœ‰ 4 ä¸ªå‡½æ•°éƒ½æµ‹è¯•åˆ°
2. **Gateway æœªåˆ·æ–°:** éƒ¨ç½²åå¿…é¡»åˆ·æ–° Gateway
3. **JSON è§£æå¼‚å¸¸:** ç¡®ä¿é”™è¯¯å¤„ç†å®Œå–„
4. **å‘åå…¼å®¹æ€§:** ç†è®ºä¸Šä¸å½±å“,ä½†éœ€è¦éªŒè¯

### æˆåŠŸæ ‡å‡†

- âœ… æ‰€æœ‰ Checklist é¡¹ç›®éƒ½æ‰“å‹¾
- âœ… ç”Ÿäº§ç¯å¢ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… æ—  JsonSchemaException é”™è¯¯
- âœ… æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸æ‰§è¡Œ

---

**å‡†å¤‡å¼€å§‹æ‰§è¡Œ?** è¯·ç¡®è®¤ä»¥ä¸Šè®¡åˆ’æ˜¯å¦ç¬¦åˆé¢„æœŸ,æˆ‘å°†æŒ‰ç…§æ­¤è®¡åˆ’é€æ­¥æ‰§è¡Œä¿®å¤å·¥ä½œã€‚
