# Common Tools MCP Server

## ğŸ“‹ æ¦‚è¿°

Common Tools MCP Server æä¾›è·¨å¹³å°çš„é€šç”¨å·¥å…·é›†ï¼Œä¸º AWS å’Œ GCP æˆæœ¬åˆ†ææä¾›ç»Ÿä¸€çš„åŸºç¡€èƒ½åŠ›ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### âœ… æ—¶é—´æ—¥æœŸå·¥å…·
- **get_today_date**: è·å–å½“å‰æ—¥æœŸçš„å¤šç§æ ¼å¼
  - æ›¿ä»£ AWS Cost Explorer MCP çš„ `get_today_date` å·¥å…·
  - é€‚ç”¨äºæ‰€æœ‰å¹³å°ï¼ˆAWSã€GCP é€šç”¨ï¼‰
  - æ— éœ€å¤–éƒ¨ä¾èµ–ï¼Œçº¯ Python å®ç°

## ğŸ”§ å·¥å…·åˆ—è¡¨

### 1. get_today_date

è·å–å½“å‰æ—¥æœŸä¿¡æ¯ï¼Œæ”¯æŒå¤šç§æ ¼å¼è¾“å‡ºã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç”¨æˆ·æŸ¥è¯¢åŒ…å«ç›¸å¯¹æ—¶é—´è¯æ±‡ï¼ˆ"ä»Šå¤©"ã€"æœ¬æœˆ"ã€"ä»Šå¹´"ç­‰ï¼‰
- éœ€è¦è®¡ç®—æ—¥æœŸèŒƒå›´ï¼ˆ"æœ€è¿‘7å¤©"ã€"ä¸Šä¸ªæœˆ"ï¼‰
- åœ¨æŸ¥è¯¢æˆæœ¬æ•°æ®ä¹‹å‰ç¡®å®šæ­£ç¡®çš„æ—¶é—´èŒƒå›´

**å‚æ•°**ï¼š
- æ— å‚æ•°

**è¿”å›æ ¼å¼**ï¼š
```json
{
  "date": "2025-01-12",           // YYYY-MM-DD æ ¼å¼ï¼ˆç”¨äº API è°ƒç”¨ï¼‰
  "year": 2025,                   // å¹´ä»½ï¼ˆæ•´æ•°ï¼‰
  "month": 1,                     // æœˆä»½ï¼ˆ1-12ï¼‰
  "day": 12,                      // æ—¥æœŸï¼ˆ1-31ï¼‰
  "year_month": "2025-01",        // YYYY-MM æ ¼å¼
  "formatted": "2025å¹´01æœˆ12æ—¥",  // äººç±»å¯è¯»æ ¼å¼
  "iso_format": "2025-01-12T10:30:45.123456",  // ISO 8601 æ ¼å¼
  "month_name": "January",        // æœˆä»½è‹±æ–‡å
  "weekday": "Sunday",            // æ˜ŸæœŸå‡ ï¼ˆè‹±æ–‡ï¼‰
  "weekday_cn": "æ˜ŸæœŸæ—¥",         // æ˜ŸæœŸå‡ ï¼ˆä¸­æ–‡ï¼‰
  "quarter": 1                    // å­£åº¦ï¼ˆ1-4ï¼‰
}
```

**ç¤ºä¾‹å·¥ä½œæµ**ï¼š
```
ç”¨æˆ·: "æŸ¥è¯¢æœ¬æœˆæˆæœ¬"

æ­¥éª¤1: è°ƒç”¨ get_today_date()
è¿”å›: {"date": "2025-01-12", "year": 2025, "month": 1, ...}

æ­¥éª¤2: è®¡ç®—æ—¥æœŸèŒƒå›´
- start_date = "2025-01-01" (æœ¬æœˆç¬¬ä¸€å¤©)
- end_date = "2025-01-12" (ä»Šå¤©)

æ­¥éª¤3: è°ƒç”¨æˆæœ¬æŸ¥è¯¢å·¥å…·
- AWS: get_cost_and_usage(start_date="2025-01-01", end_date="2025-01-12")
- GCP: gcp_cost_summary(start_date="2025-01-01", end_date="2025-01-12")
```

## ğŸ“¦ ä¾èµ–

**Python æ ‡å‡†åº“**ï¼š
- `datetime`: æ—¥æœŸæ—¶é—´å¤„ç†
- `json`: JSON åºåˆ—åŒ–
- `logging`: æ—¥å¿—è®°å½•

**å¤–éƒ¨ä¾èµ–**ï¼š
- `mcp>=1.1.0`: MCP åè®®å®ç°

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æœ¬åœ°æµ‹è¯•

```bash
# ç›´æ¥è¿è¡Œ MCP Server
python -m backend.mcp.common_tools_mcp_server.server

# æˆ–ä½¿ç”¨ stdio æ¨¡å¼
python -m backend.mcp.common_tools_mcp_server.server
```

### é›†æˆåˆ° Agent

åœ¨ `backend/mcp/mcp_manager.py` ä¸­å·²è‡ªåŠ¨é›†æˆï¼š

```python
# Common Tools å·²æ·»åŠ åˆ° DEFAULT_SERVER_TYPES
DEFAULT_SERVER_TYPES = [
    "common-tools",  # é€šç”¨å·¥å…·é›†
    # "cost-explorer",  # å·²æ³¨é‡Šï¼ˆè¢« common-tools æ›¿ä»£ get_today_date åŠŸèƒ½ï¼‰
    ...
]

# åˆ›å»ºå®¢æˆ·ç«¯
manager = MCPManager()
clients = manager.create_all_clients()  # è‡ªåŠ¨åŒ…å« common-tools
```

## ğŸ”„ ä¸å…¶ä»– MCP Server çš„å…³ç³»

### æ›¿ä»£å…³ç³»
- **æ›¿ä»£**: AWS Cost Explorer MCP çš„ `get_today_date` å·¥å…·
- **åŸå› **:
  - å‡å°‘ä¾èµ–ï¼šä¸éœ€è¦åŠ è½½å®Œæ•´çš„ Cost Explorer MCP
  - ç»Ÿä¸€å·¥å…·ï¼šAWS å’Œ GCP ä½¿ç”¨åŒä¸€ä¸ªæ—¶é—´å·¥å…·
  - æ€§èƒ½ä¼˜åŒ–ï¼šè½»é‡çº§å®ç°ï¼Œå¯åŠ¨æ›´å¿«

### é…åˆå…³ç³»
- **AWS æˆæœ¬æŸ¥è¯¢**: ä½¿ç”¨ `get_today_date` ç¡®å®šæŸ¥è¯¢èŒƒå›´
- **GCP æˆæœ¬æŸ¥è¯¢**: ä½¿ç”¨ `get_today_date` ç¡®å®šæŸ¥è¯¢èŒƒå›´
- **RISP åˆ†æ**: ä½¿ç”¨ `get_today_date` åˆ†æå½“å‰æœˆä»½çš„ RI/SP è¦†ç›–ç‡
- **Alert ç®¡ç†**: ä½¿ç”¨ `get_today_date` åˆ¤æ–­æ˜¯å¦åº”è¯¥æ‰§è¡Œå‘Šè­¦æ£€æŸ¥

## ğŸ“ ç³»ç»Ÿæç¤ºè¯çº¦æŸ

åœ¨ `backend/agent/prompts/shared/time_handling.md` ä¸­å·²å®šä¹‰ï¼š

```markdown
**å½“ç”¨æˆ·æåˆ°æ—¶é—´ç›¸å…³è¯æ±‡æ—¶ï¼Œå¿…é¡»å…ˆè°ƒç”¨ `get_today_date` è·å–å½“å‰æ—¥æœŸï¼**

ç”¨æˆ·å¯èƒ½ä½¿ç”¨çš„æ—¶é—´è¯æ±‡ï¼š
- "ä»Šå¤©"ã€"ä»Šæ—¥"ã€"today"
- "æœ¬æœˆ"ã€"è¿™ä¸ªæœˆ"ã€"å½“æœˆ"ã€"this month"
- "æœ¬å¹´"ã€"ä»Šå¹´"ã€"this year"
- "ä¸Šæœˆ"ã€"ä¸Šä¸ªæœˆ"ã€"last month"
- "æœ€è¿‘"ã€"è¿‘æœŸ"ã€"recent"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ—¶åŒºå¤„ç†**ï¼š
   - è¿”å›çš„æ—¥æœŸåŸºäºæœåŠ¡å™¨æœ¬åœ°æ—¶åŒº
   - é€‚ç”¨äº AWS å’Œ GCP æˆæœ¬æ•°æ®æŸ¥è¯¢ï¼ˆUTC å’Œæœ¬åœ°æ—¶é—´é€šç”¨ï¼‰

2. **æ—¥æœŸæ ¼å¼**ï¼š
   - API è°ƒç”¨ä½¿ç”¨ `date` å­—æ®µï¼ˆYYYY-MM-DD æ ¼å¼ï¼‰
   - ç”¨æˆ·æ˜¾ç¤ºä½¿ç”¨ `formatted` å­—æ®µ

3. **æ— éœ€å‡­è¯**ï¼š
   - Common Tools ä¸éœ€è¦ AWS/GCP å‡­è¯
   - çº¯å·¥å…·å‡½æ•°ï¼Œæ— å¤–éƒ¨ API è°ƒç”¨

## ğŸ” è®¾è®¡å†³ç­–

### ä¸ºä»€ä¹ˆåˆ›å»º Common Tools MCPï¼Ÿ

1. **å‡å°‘ä¾èµ–**ï¼š
   - AWS Cost Explorer MCP åŒ…å«å¤§é‡æˆæœ¬åˆ†æå·¥å…·
   - ä½†æˆ‘ä»¬åªéœ€è¦å…¶ä¸­çš„ `get_today_date` å·¥å…·
   - å•ç‹¬å®ç°å¯ä»¥é¿å…åŠ è½½ä¸å¿…è¦çš„ä¾èµ–

2. **ç»Ÿä¸€å·¥å…·**ï¼š
   - åŸæœ¬ AWS å’Œ GCP å„æœ‰è‡ªå·±çš„ `get_today_date`
   - ç°åœ¨ç»Ÿä¸€ä½¿ç”¨ Common Tools çš„å®ç°
   - é¿å…é‡å¤ä»£ç ï¼Œæ˜“äºç»´æŠ¤

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - è½»é‡çº§å®ç°ï¼Œå¯åŠ¨é€Ÿåº¦æ›´å¿«
   - å‡å°‘ MCP Server æ•°é‡ï¼Œé™ä½èµ„æºæ¶ˆè€—

### ä¸ºä»€ä¹ˆä¸ç§»é™¤ Cost Explorer MCPï¼Ÿ

- Cost Explorer MCP è¿˜æä¾›å…¶ä»–é‡è¦å·¥å…·ï¼š
  - `get_cost_and_usage`: AWS æˆæœ¬æŸ¥è¯¢
  - `get_cost_forecast`: æˆæœ¬é¢„æµ‹
  - `get_dimension_values`: ç»´åº¦å€¼æŸ¥è¯¢
  - ç­‰ç­‰...
- åªæ˜¯æ³¨é‡Šæ‰ï¼Œä¿ç•™ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
- å¦‚æœéœ€è¦å®Œæ•´çš„ Cost Explorer åŠŸèƒ½ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Š

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [MCP Manager æ–‡æ¡£](../README.md)
- [ç³»ç»Ÿæç¤ºè¯ - æ—¶é—´å¤„ç†](../../agent/prompts/shared/time_handling.md)
- [GCP Cost ç¤ºä¾‹](../../agent/prompts/examples/gcp_cost.md)
- [æˆæœ¬åˆ†æç¤ºä¾‹](../../agent/prompts/examples/cost_analysis.md)

## ğŸ”„ ç‰ˆæœ¬å†å²

### v1.0.0 (2025-01-12)
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… å®ç° `get_today_date` å·¥å…·
- âœ… æ›¿ä»£ AWS Cost Explorer MCP çš„æ—¶é—´å·¥å…·
- âœ… æ”¯æŒå¤šç§æ—¥æœŸæ ¼å¼è¾“å‡º
- âœ… é›†æˆåˆ° MCP Manager
